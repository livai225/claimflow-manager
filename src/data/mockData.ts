import { User, Claim, DashboardStats, ClaimStatus, ClaimType, UserRole, ProcessStep, Participant } from '@/types/claims';

const createInitialSteps = (): ProcessStep[] => [
  {
    id: 'declaration',
    title: '1. Déclaration du sinistre',
    description: [
      "Délai de 5 jours pour déclarer le sinistre à l'assureur dès sa connaissance (Article 27, paragraphe 4 du Code des assurances).",
      'À la réception de la déclaration :',
      '• Accuser réception',
      '• Demander les pièces de procédure',
      "• Mandater un expert pour l'évaluation des dommages",
      '• Attribuer un numéro de sinistre au dossier',
    ],
    status: 'in_progress',
    startedAt: new Date(),
    requiredActions: ['Vérifier les documents fournis', 'Assigner un gestionnaire', "Passer à l'analyse"],
  },
  {
    id: 'instruction',
    title: "2. Phase d'instruction",
    description: [
      'À la réception des pièces de procédure :',
      "• Délivrer un acte de nomination à l'expert mandaté",
      "• Délai de 2 semaines pour le dépôt des conclusions de l'expert",
      '\nPour les sinistres corporels :',
      "• Délivrer un bon de prise en charge pour l'hôpital",
      "• Délivrer une lettre de demande d'informations pour la victime ou les ayants droit (Articles 81 et 89 du Code des assurances)",
    ],
    status: 'pending',
    requiredActions: ['Attendre les pièces de procédure', 'Désigner un expert si nécessaire', 'Délivrer les documents requis'],
  },
  {
    id: 'expertise',
    title: '3. Expertise et évaluation',
    description: [
      "L'expert doit évaluer les dommages et fournir un rapport détaillé.",
      "L'expert dispose d'un délai de 15 jours pour rendre son rapport.",
      'Le rapport doit inclure :',
      '• L\u2019évaluation des dommages',
      '• Les causes du sinistre',
      '• Les mesures de prévention recommandées',
    ],
    status: 'pending',
    requiredActions: ["Attendre le rapport d'expertise", "Valider l'estimation des dommages", 'Préparer le dossier pour validation'],
  },
  {
    id: 'validation',
    title: '4. Validation et décision',
    description: [
      "Le gestionnaire doit valider le rapport d'expertise.",
      "En cas d'accord, préparer la proposition d'indemnisation.",
      "En cas de désaccord, demander des compléments d'information.",
      'Transmettre la décision au service compétent pour le paiement.',
    ],
    status: 'pending',
    requiredActions: ['Réviser le montant proposé', 'Approuver ou rejeter le dossier', 'Notifier le déclarant'],
  },
  {
    id: 'paiement',
    title: '5. Paiement et clôture',
    description: [
      "Préparer l'ordre de paiement.",
      'Vérifier les coordonnées bancaires du bénéficiaire.',
      'Effectuer le virement bancaire.',
      'Archiver le dossier une fois le paiement effectué.',
    ],
    status: 'pending',
    requiredActions: ["Préparer l'ordre de paiement", 'Vérifier les coordonnées bancaires', 'Effectuer le virement'],
  },
];

const createParticipants = (claim: Pick<Claim, 'declarant' | 'assignedTo' | 'expert'>): Participant[] => {
  const participants: Participant[] = [
    {
      ...claim.declarant,
      role: claim.declarant.role,
      roleLabel: 'Déclarant',
    },
  ];

  if (claim.assignedTo) {
    participants.push({
      ...claim.assignedTo,
      role: claim.assignedTo.role,
      roleLabel: 'Gestionnaire',
    });
  }

  if (claim.expert) {
    participants.push({
      ...claim.expert,
      role: claim.expert.role,
      roleLabel: 'Expert',
    });
  }

  return participants;
};

export const mockUsers: User[] = [
  {
    id: 'user-1',
    email: 'admin@assurflow.gn',
    name: 'Mamadou Diallo',
    role: 'admin',
    avatar: 'MD',
    createdAt: new Date('2023-01-15'),
  },
  {
    id: 'user-2',
    email: 'gestionnaire@assurflow.gn',
    name: 'Fatoumata Camara',
    role: 'gestionnaire',
    avatar: 'FC',
    createdAt: new Date('2023-03-20'),
  },
  {
    id: 'user-3',
    email: 'expert@assurflow.gn',
    name: 'Ibrahima Sow',
    role: 'expert',
    avatar: 'IS',
    createdAt: new Date('2023-05-10'),
  },
  {
    id: 'user-4',
    email: 'superviseur@assurflow.gn',
    name: 'Aissatou Bah',
    role: 'superviseur',
    avatar: 'AB',
    createdAt: new Date('2023-02-28'),
  },
  {
    id: 'user-5',
    email: 'comptable@assurflow.gn',
    name: 'Ousmane Kouyaté',
    role: 'comptabilite',
    avatar: 'OK',
    createdAt: new Date('2023-04-15'),
  },
  {
    id: 'user-6',
    email: 'client@email.gn',
    name: 'Kadiatou Condé',
    role: 'assure',
    avatar: 'KC',
    createdAt: new Date('2024-01-10'),
  },
];

export const mockClaims: Claim[] = [
  {
    id: 'CLM-2024-001',
    policyNumber: 'POL-AUTO-78542',
    type: 'auto',
    status: 'en_analyse',
    declarant: mockUsers[5], // Kadiatou Condé (client)
    assignedTo: mockUsers[1], // Fatoumata Camara (gestionnaire)
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: undefined }),
    dateIncident: new Date('2024-11-15'),
    dateDeclaration: new Date('2024-11-16'),
    location: 'Kaloum, Avenue de la République, Conakry',
    description: 'Collision avec un autre véhicule au niveau du rond-point de Kaloum. Dégâts importants sur l\'avant du véhicule.',
    estimatedAmount: 45000000,
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      {
        id: 'doc-1',
        name: 'Constat amiable.pdf',
        type: 'application/pdf',
        url: '#',
        uploadedAt: new Date('2024-11-16'),
        uploadedBy: mockUsers[5],
      },
      {
        id: 'doc-2',
        name: 'Photos dégâts.jpg',
        type: 'image/jpeg',
        url: '#',
        uploadedAt: new Date('2024-11-16'),
        uploadedBy: mockUsers[5],
      },
    ],
    events: [
      {
        id: 'evt-1',
        type: 'creation',
        description: 'Déclaration de sinistre créée par Fatoumata Camara',
        date: new Date('2024-11-16'),
        user: mockUsers[1],
      },
      {
        id: 'evt-2',
        type: 'affectation',
        description: 'Dossier assigné à Fatoumata Camara',
        date: new Date('2024-11-17'),
        user: mockUsers[0],
      },
    ],
    createdAt: new Date('2024-11-16'),
    updatedAt: new Date('2024-11-17'),
  },
  {
    id: 'CLM-2024-002',
    policyNumber: 'POL-HAB-45123',
    type: 'habitation',
    status: 'approuve',
    declarant: mockUsers[5], // Kadiatou Condé (client)
    assignedTo: mockUsers[1],
    expert: mockUsers[2],
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: mockUsers[2] }),
    dateIncident: new Date('2024-10-20'),
    dateDeclaration: new Date('2024-10-21'),
    location: 'Matam, Quartier Hamdallaye, Conakry',
    description: 'Dégât des eaux suite à une fuite de canalisation. Plusieurs pièces endommagées.',
    estimatedAmount: 28000000,
    approvedAmount: 25000000,
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      { id: 'doc-3', name: 'Photos plafond.jpg', type: 'photo', url: '#', uploadedAt: new Date('2024-11-29'), uploadedBy: mockUsers[5] },
      { id: 'doc-4', name: 'Devis réparation.pdf', type: 'devis', url: '#', uploadedAt: new Date('2024-11-30'), uploadedBy: mockUsers[5] },
    ],
    events: [
      { id: 'evt-3', type: 'creation', description: 'Déclaration de sinistre créée', date: new Date('2024-11-29'), user: mockUsers[5] },
      { id: 'evt-4', type: 'affectation', description: 'Dossier affecté à Pierre Martin', date: new Date('2024-11-29'), user: mockUsers[0] },
      { id: 'evt-5', type: 'statut', description: 'Statut changé vers En analyse', date: new Date('2024-11-30'), user: mockUsers[1] },
    ],
    createdAt: new Date('2024-11-29'),
    updatedAt: new Date('2024-11-30'),
  },
  {
    id: 'CLM-2024-003',
    policyNumber: 'POL-AUTO-89654',
    type: 'auto',
    status: 'en_expertise',
    declarant: mockUsers[5],
    assignedTo: mockUsers[1],
    expert: mockUsers[2],
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: mockUsers[2] }),
    dateIncident: new Date('2024-11-15'),
    dateDeclaration: new Date('2024-11-16'),
    location: 'Kankan, Centre-ville',
    description: 'Vol de matériel médical dans le cabinet. Porte forcée.',
    estimatedAmount: 120000000,
    paidAmount: 105000000,
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      { id: 'doc-5', name: 'Dépôt de plainte.pdf', type: 'rapport', url: '#', uploadedAt: new Date('2024-11-16'), uploadedBy: mockUsers[5] },
      { id: 'doc-6', name: 'Carte grise.pdf', type: 'administratif', url: '#', uploadedAt: new Date('2024-11-16'), uploadedBy: mockUsers[5] },
    ],
    expertise: {
      id: 'exp-1',
      expertId: 'user-3',
      claimId: 'CLM-2024-003',
      status: 'en_cours',
      scheduledDate: new Date('2024-12-10'),
      createdAt: new Date('2024-11-20'),
    },
    events: [
      { id: 'evt-6', type: 'creation', description: 'Déclaration de sinistre créée', date: new Date('2024-11-16'), user: mockUsers[5] },
      { id: 'evt-7', type: 'affectation', description: 'Dossier affecté à Pierre Martin', date: new Date('2024-11-16'), user: mockUsers[0] },
      { id: 'evt-8', type: 'expertise', description: 'Expert Sophie Bernard désigné', date: new Date('2024-11-20'), user: mockUsers[1] },
    ],
    createdAt: new Date('2024-11-16'),
    updatedAt: new Date('2024-11-20'),
  },
  {
    id: 'CLM-2024-004',
    policyNumber: 'POL-SANTE-12367',
    type: 'sante',
    status: 'en_validation',
    declarant: mockUsers[5],
    assignedTo: mockUsers[1],
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: undefined }),
    dateIncident: new Date('2024-09-10'),
    dateDeclaration: new Date('2024-09-11'),
    location: 'Kindia, Quartier Madina',
    description: 'Incendie partiel de la cuisine suite à un court-circuit.',
    estimatedAmount: 250000000,
    approvedAmount: 3800,
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      { id: 'doc-7', name: 'Facture hôpital.pdf', type: 'facture', url: '#', uploadedAt: new Date('2024-11-12'), uploadedBy: mockUsers[5] },
      { id: 'doc-8', name: 'Ordonnance.pdf', type: 'administratif', url: '#', uploadedAt: new Date('2024-11-12'), uploadedBy: mockUsers[5] },
    ],
    events: [
      { id: 'evt-9', type: 'creation', description: 'Déclaration de sinistre créée', date: new Date('2024-11-12'), user: mockUsers[5] },
      { id: 'evt-10', type: 'validation', description: 'Dossier soumis pour validation', date: new Date('2024-11-25'), user: mockUsers[1] },
    ],
    createdAt: new Date('2024-11-12'),
    updatedAt: new Date('2024-11-25'),
  },
  {
    id: 'CLM-2024-005',
    policyNumber: 'POL-HAB-78965',
    type: 'habitation',
    status: 'approuve',
    declarant: mockUsers[5],
    assignedTo: mockUsers[1],
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: undefined }),
    dateIncident: new Date('2024-10-20'),
    dateDeclaration: new Date('2024-10-21'),
    location: 'Toulouse, Place du Capitole',
    description: 'Cambriolage avec effraction. Vol de matériel informatique et bijoux.',
    estimatedAmount: 15000,
    approvedAmount: 12500,
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      { id: 'doc-9', name: 'Dépôt de plainte.pdf', type: 'rapport', url: '#', uploadedAt: new Date('2024-10-21'), uploadedBy: mockUsers[5] },
      { id: 'doc-10', name: 'Liste objets volés.pdf', type: 'administratif', url: '#', uploadedAt: new Date('2024-10-22'), uploadedBy: mockUsers[5] },
      { id: 'doc-11', name: 'Rapport expertise.pdf', type: 'expertise', url: '#', uploadedAt: new Date('2024-11-05'), uploadedBy: mockUsers[2] },
    ],
    events: [
      { id: 'evt-11', type: 'creation', description: 'Déclaration de sinistre créée', date: new Date('2024-10-21'), user: mockUsers[5] },
      { id: 'evt-12', type: 'validation', description: 'Dossier approuvé - Montant: 12 500€', date: new Date('2024-11-10'), user: mockUsers[3] },
    ],
    createdAt: new Date('2024-10-21'),
    updatedAt: new Date('2024-11-10'),
  },
  {
    id: 'CLM-2024-006',
    policyNumber: 'POL-AUTO-45678',
    type: 'auto',
    status: 'paye',
    declarant: mockUsers[5],
    assignedTo: mockUsers[1],
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: undefined }),
    dateIncident: new Date('2024-10-20'),
    dateDeclaration: new Date('2024-10-21'),
    location: 'Labé, Route de Pita',
    description: 'Accident de la route avec blessures légères.',
    estimatedAmount: 150000000,
    approvedAmount: 850,
    paidAmount: 140000000,
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      { id: 'doc-12', name: 'Constat.pdf', type: 'constat', url: '#', uploadedAt: new Date('2024-09-16'), uploadedBy: mockUsers[5] },
    ],
    payment: {
      id: 'pay-1',
      claimId: 'CLM-2024-006',
      amount: 850,
      status: 'paye',
      method: 'virement',
      reference: 'VIR-2024-00156',
      processedAt: new Date('2024-10-01'),
      createdAt: new Date('2024-09-28'),
    },
    events: [
      { id: 'evt-13', type: 'creation', description: 'Déclaration de sinistre créée', date: new Date('2024-09-16'), user: mockUsers[5] },
      { id: 'evt-14', type: 'paiement', description: 'Paiement effectué - 850€', date: new Date('2024-10-01'), user: mockUsers[4] },
    ],
    createdAt: new Date('2024-09-16'),
    updatedAt: new Date('2024-10-01'),
  },
  {
    id: 'CLM-2024-007',
    policyNumber: 'POL-RC-34521',
    type: 'responsabilite_civile',
    status: 'clos',
    declarant: mockUsers[5],
    assignedTo: mockUsers[1],
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: undefined }),
    dateIncident: new Date('2024-07-15'),
    dateDeclaration: new Date('2024-07-16'),
    location: 'Nzérékoré, Marché central',
    description: 'Chute dans un magasin causant une fracture du poignet.',
    estimatedAmount: 50000000,
    approvedAmount: 2000,
    paidAmount: 2000,
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      { id: 'doc-13', name: 'Déclaration.pdf', type: 'administratif', url: '#', uploadedAt: new Date('2024-08-12'), uploadedBy: mockUsers[5] },
      { id: 'doc-14', name: 'Facture réparation.pdf', type: 'facture', url: '#', uploadedAt: new Date('2024-08-20'), uploadedBy: mockUsers[5] },
    ],
    payment: {
      id: 'pay-2',
      claimId: 'CLM-2024-007',
      amount: 2000,
      status: 'paye',
      method: 'virement',
      reference: 'VIR-2024-00142',
      processedAt: new Date('2024-09-05'),
      createdAt: new Date('2024-09-01'),
    },
    events: [
      { id: 'evt-15', type: 'creation', description: 'Déclaration de sinistre créée', date: new Date('2024-08-12'), user: mockUsers[5] },
      { id: 'evt-16', type: 'paiement', description: 'Paiement effectué - 2 000€', date: new Date('2024-09-05'), user: mockUsers[4] },
      { id: 'evt-17', type: 'cloture', description: 'Dossier clôturé', date: new Date('2024-09-10'), user: mockUsers[1] },
    ],
    createdAt: new Date('2024-08-12'),
    updatedAt: new Date('2024-09-10'),
  },
  {
    id: 'CLM-2024-008',
    policyNumber: 'POL-AUTO-99876',
    type: 'auto',
    status: 'rejete',
    declarant: mockUsers[5],
    assignedTo: mockUsers[1],
    participants: createParticipants({ declarant: mockUsers[5], assignedTo: mockUsers[1], expert: undefined }),
    dateIncident: new Date('2024-07-25'),
    dateDeclaration: new Date('2024-07-28'),
    location: 'Boké, Route nationale',
    description: 'Demande d\'indemnisation pour usure des pneus.',
    estimatedAmount: 6000000,
    rejectionReason: 'L\'usure normale des pneus n\'est pas couverte par le contrat d\'assurance auto.',
    processSteps: createInitialSteps(),
    currentStepId: 'declaration',
    documents: [
      { id: 'doc-15', name: 'Photos pneus.jpg', type: 'photo', url: '#', uploadedAt: new Date('2024-07-28'), uploadedBy: mockUsers[5] },
    ],
    events: [
      { id: 'evt-18', type: 'creation', description: 'Déclaration de sinistre créée', date: new Date('2024-07-28'), user: mockUsers[5] },
      { id: 'evt-19', type: 'rejet', description: 'Dossier rejeté - Hors garantie', date: new Date('2024-08-05'), user: mockUsers[3] },
    ],
    createdAt: new Date('2024-07-28'),
    updatedAt: new Date('2024-08-05'),
  },
];

export const mockDashboardStats: DashboardStats = {
  totalClaims: mockClaims.length,
  openClaims: mockClaims.filter(c => ['ouvert', 'en_analyse', 'en_expertise', 'en_validation'].includes(c.status)).length,
  closedClaims: mockClaims.filter(c => ['clos', 'paye'].includes(c.status)).length,
  totalPaid: mockClaims.reduce((sum, c) => sum + (c.paidAmount || 0), 0),
  avgProcessingDays: 18,
  claimsByStatus: {
    ouvert: mockClaims.filter(c => c.status === 'ouvert').length,
    en_analyse: mockClaims.filter(c => c.status === 'en_analyse').length,
    en_expertise: mockClaims.filter(c => c.status === 'en_expertise').length,
    en_validation: mockClaims.filter(c => c.status === 'en_validation').length,
    approuve: mockClaims.filter(c => c.status === 'approuve').length,
    rejete: mockClaims.filter(c => c.status === 'rejete').length,
    paye: mockClaims.filter(c => c.status === 'paye').length,
    clos: mockClaims.filter(c => c.status === 'clos').length,
  },
  claimsByType: {
    auto: mockClaims.filter(c => c.type === 'auto').length,
    habitation: mockClaims.filter(c => c.type === 'habitation').length,
    sante: mockClaims.filter(c => c.type === 'sante').length,
    responsabilite_civile: mockClaims.filter(c => c.type === 'responsabilite_civile').length,
    vie: mockClaims.filter(c => c.type === 'vie').length,
  },
};
